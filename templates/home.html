{% extends "base.html" %}

{% block head %}
  <style>
    @keyframes fadein {
      from { opacity: 0; transform: translateY(-30px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    .animate-fadein {
      animation: fadein 1s cubic-bezier(.4,0,.2,1) 0.1s both;
    }
    /* Effetto hover più visibile per le card */
    .card-animated {
      transition: transform 0.35s cubic-bezier(.4,0,.2,1), box-shadow 0.35s cubic-bezier(.4,0,.2,1);
    }
    .card-animated:hover {
      transform: scale(1.13) translateY(-8px) rotate(-1deg);
      box-shadow: 0 12px 36px 0 rgba(0,0,0,0.28), 0 2px 8px 0 rgba(0,0,0,0.10);
      z-index: 2;
    }
    /* Bordo spesso, arrotondato e colorato per le card principali */
    .card-news { border: 5px solid #2563eb; border-radius: 2rem; }
    .card-docs { border: 5px solid #6366f1; border-radius: 1.5rem; }
    .card-links { border: 5px solid #22c55e; border-radius: 1.5rem; }
    .card-contacts { border: 5px solid #fbbf24; border-radius: 1.5rem; }
    /* Bordo arrotondato e colorato per le etichette di sezione */
    .section-label-blue { border: 2.5px solid #6366f1; border-radius: 1.2rem; }
    .section-label-green { border: 2.5px solid #22c55e; border-radius: 1.2rem; }
    .section-label-yellow { border: 2.5px solid #fbbf24; border-radius: 1.2rem; }
    .section-label-violet { border: 2.5px solid #a78bfa; border-radius: 1.2rem; }
    /* Bordo sottile e arrotondato per la card news */
    .card-news-thin {
      border: 1.5px solid #7c3aed;
      border-radius: 2rem;
    }
    .drop-shadow {
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.18));
    }
    /* Scrollbar visibile solo su hover */
    .flex-1.flex.flex-nowrap::-webkit-scrollbar {
      height: 8px;
    }
    .flex-1.flex.flex-nowrap::-webkit-scrollbar-thumb {
      background: #a78bfa;
      border-radius: 4px;
    }
  </style>
{% endblock %}

{% block content %}
{% set foto_url = '/media/foto/' ~ user._id|string ~ '.jpg?v=' ~ datetime.utcnow().timestamp() %}
<div class="relative min-h-screen w-full flex flex-col justify-between" style="background-image: url('/static/img/hero-hqe.jpg'); background-size: cover; background-position: center;">
    <!-- Overlay user in alto a sinistra, fuori dal contenitore centrale -->
    <div class="absolute left-8 top-8 flex items-center z-20 bg-blue-900/70 rounded-xl px-4 py-2 shadow-lg">
      <img src="{{ foto_url }}"
           onerror="this.src='/static/img/avatar-default.png'"
           alt="Foto profilo"
           class="w-12 h-12 rounded-full border-2 border-white mr-3"
           style="transition: transform 0.3s; will-change: transform;"
           onmouseover="this.style.transform='scale(1.22) rotate(3deg)'"
           onmouseout="this.style.transform='none'">
      <div>
        <div class="text-lg font-bold text-white">{{ user.name.split(' ')[-1] }}</div>
        <div class="text-xs text-white/80">{{ saluto }}</div>
      </div>
    </div>
    <div class="absolute inset-0 bg-gradient-to-b from-blue-900/60 via-blue-700/40 to-blue-400/20"></div>
    <div class="relative z-10 w-full flex flex-col items-center pt-10">
        <!-- Logo e titolo centrati -->
        <div class="w-full flex justify-center mb-8">
          <div class="bg-white border-2 border-blue-300 rounded-xl px-6 py-3 shadow-xl flex items-center justify-center" style="max-width: 340px;">
            <img src="/static/img/Logo_HQ.png"
                 alt="HQ"
                 class="h-[64px] w-auto object-contain" />
          </div>
        </div>
    </div>
    <!-- Sticky NEWS BAR fuori dal contenitore centrale, allungata -->
    {% include "partials/news_ticker.html" %}
    <div class="relative z-10 w-full max-w-2xl mx-auto px-4 flex flex-col items-center">
        <!-- IN EVIDENZA RAGGRUPPATA PER TIPOLOGIA -->
        {% include "partials/home_highlights.html" %}
        <div class="pb-32"></div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const ticker = document.getElementById('news-ticker');
  let scrollInterval = null;

  function startScroll() {
    if (scrollInterval) return; // già in corso
    scrollInterval = setInterval(() => {
      ticker.scrollLeft += 2;
      if (ticker.scrollLeft + ticker.clientWidth >= ticker.scrollWidth - 2) {
        ticker.scrollLeft = 0;
      }
    }, 16);
  }

  function stopScroll() {
    if (scrollInterval) {
      clearInterval(scrollInterval);
      scrollInterval = null;
    }
  }

  if (ticker) {
    ticker.addEventListener('mouseenter', startScroll);
    ticker.addEventListener('mouseleave', stopScroll);
  }
});
</script>
{% endblock %}
